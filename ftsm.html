<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AN560: Sam LeBlanc - Financial Time Series Models (ARCH/GARCH)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./greenhouse_gases_deep_learning.html" rel="next">
<link href="./arimax.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Financial Time Series Models (ARCH/GARCH)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/gg.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./me.html" class="sidebar-item-text sidebar-link">About Me</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ds.html" class="sidebar-item-text sidebar-link">Data Sources</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dv.html" class="sidebar-item-text sidebar-link">Data Visualizations</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda.html" class="sidebar-item-text sidebar-link">Exploratory Data Analysis</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arma.html" class="sidebar-item-text sidebar-link">ARMA/ARIMA/SARIMA Models</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arimax.html" class="sidebar-item-text sidebar-link">ARIMAX/SARIMAX/VAR</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ftsm.html" class="sidebar-item-text sidebar-link active">Financial Time Series Models (ARCH/GARCH)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./greenhouse_gases_deep_learning.html" class="sidebar-item-text sidebar-link">Deep Learning for TS</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conc.html" class="sidebar-item-text sidebar-link">Conclusions</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#carvana-model-fitting-with-arima-and-garch" id="toc-carvana-model-fitting-with-arima-and-garch" class="nav-link active" data-scroll-target="#carvana-model-fitting-with-arima-and-garch">Carvana Model Fitting with ARIMA and GARCH</a></li>
  <li><a href="#stationarity" id="toc-stationarity" class="nav-link" data-scroll-target="#stationarity">Stationarity</a></li>
  <li><a href="#garchpq-model-fitting-with-arima" id="toc-garchpq-model-fitting-with-arima" class="nav-link" data-scroll-target="#garchpq-model-fitting-with-arima">GARCH(p,q) model fitting with ARIMA</a>
  <ul class="collapse">
  <li><a href="#archtest" id="toc-archtest" class="nav-link" data-scroll-target="#archtest">ArchTest</a></li>
  <li><a href="#arima-model" id="toc-arima-model" class="nav-link" data-scroll-target="#arima-model">ARIMA model</a></li>
  </ul></li>
  <li><a href="#garch-model" id="toc-garch-model" class="nav-link" data-scroll-target="#garch-model">GARCH model</a>
  <ul class="collapse">
  <li><a href="#final-model" id="toc-final-model" class="nav-link" data-scroll-target="#final-model">Final Model</a></li>
  <li><a href="#forecast" id="toc-forecast" class="nav-link" data-scroll-target="#forecast">Forecast</a></li>
  </ul></li>
  <li><a href="#volatality-plot" id="toc-volatality-plot" class="nav-link" data-scroll-target="#volatality-plot">Volatality plot</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Financial Time Series Models (ARCH/GARCH)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="carvana-model-fitting-with-arima-and-garch" class="level2">
<h2 class="anchored" data-anchor-id="carvana-model-fitting-with-arima-and-garch">Carvana Model Fitting with ARIMA and GARCH</h2>
<p>Since my project has exactly nothing to do with financial time series data (which was not a requirement when choosing projects) I will instead focus on a completely random topic because that’s what the professor told me to do. So fun and worthwhile!</p>
<p>First, let’s get the stock data for our favorite company Carvana! After getting the data, we plot to see what we are working with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>CVNA <span class="ot">=</span> <span class="fu">getSymbols</span>(<span class="st">"CVNA"</span>,<span class="at">auto.assign =</span> <span class="cn">FALSE</span>, <span class="at">from =</span> <span class="st">"2014-10-01"</span>,<span class="at">src=</span><span class="st">"yahoo"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chartSeries</span>(CVNA, <span class="at">theme =</span> <span class="fu">chartTheme</span>(<span class="st">"white"</span>), </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">bar.type =</span> <span class="st">"hlc"</span>,  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">up.col =</span> <span class="st">"green"</span>,  </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">dn.col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(CVNA<span class="sc">$</span><span class="st">`</span><span class="at">CVNA.Adjusted</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">diff</span>() <span class="sc">%&gt;%</span> <span class="fu">chartSeries</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the data, it would be wise to take the logarithm since the values are highly skewed from when the stock was doing well and when it was doing poorly.</p>
</section>
<section id="stationarity" class="level2">
<h2 class="anchored" data-anchor-id="stationarity">Stationarity</h2>
<p>As with most ARCH/GARCH models, we will be modelling the returns rather than the raw data. This is partly why we took the logarithm, so that the returns are on a more reasonable scale from different time periods of the stock.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cvna <span class="ot">=</span> <span class="fu">ts</span>(CVNA<span class="sc">$</span><span class="st">`</span><span class="at">CVNA.Adjusted</span><span class="st">`</span>, <span class="at">start=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2014-10-01"</span>)), <span class="at">frequency =</span> <span class="fl">365.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(cvna) <span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Carvana Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cvna <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Plotting the raw data, we can see that this series is clearly not stationary. There is extremely high correlation between values as well as string seasonality present in the data. Thus, to address the non-stationarity, we will need to do differencing. In addition to differencing, we will also need to calculate the logarithm of the data to account for large variations in price that occurred over the time frame of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>returns <span class="ot">=</span> <span class="fu">log</span>(cvna) <span class="sc">%&gt;%</span> <span class="fu">diff</span>()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>returns <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the ACF plot, we can see that after taking the log and differenc of the data, this series is now weakly stationary. There is no need for additional differencing as the ACF and PACF plots are looking good already. Any extra differencing would result in over-differencing and would make modeling more difficult.</p>
</section>
<section id="garchpq-model-fitting-with-arima" class="level2">
<h2 class="anchored" data-anchor-id="garchpq-model-fitting-with-arima">GARCH(p,q) model fitting with ARIMA</h2>
<section id="archtest" class="level3">
<h3 class="anchored" data-anchor-id="archtest">ArchTest</h3>
<p>First, we check for ARCH effects with the <code>ArchTest()</code> function. We will use a standard significance level of <span class="math inline">\(\alpha=0.05\)</span> for our null hypothesis test. Because the p-value is much smaller than 0.05, so we reject the null hypothesis and conclude the presence of ARCH(1) effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ArchTest</span>(returns, <span class="at">lags=</span><span class="dv">1</span>, <span class="at">demean=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    ARCH LM-test; Null hypothesis: no ARCH effects

data:  returns
Chi-squared = 50.596, df = 1, p-value = 1.135e-12</code></pre>
</div>
</div>
</section>
<section id="arima-model" class="level3">
<h3 class="anchored" data-anchor-id="arima-model">ARIMA model</h3>
<p>Let’s fit the ARIMA model first. We follow the same procedure as previously. For more on ARIMA models, check out the other tabs of the website.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ARIMA.f<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,data){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">6</span><span class="sc">*</span><span class="dv">24</span>),<span class="at">nrow=</span><span class="dv">24</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2){</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>q<span class="sc">&lt;=</span><span class="dv">8</span>){</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        model<span class="ot">=</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p,<span class="dv">1</span>,q))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p,<span class="dv">1</span>,q,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  temp</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">=</span> <span class="fu">ARIMA.f</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="at">data=</span><span class="fu">log</span>(cvna))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q       AIC       BIC      AICc
1  0 1 0 -4029.563 -4024.244 -4029.561
2  0 1 1 -4029.215 -4018.576 -4029.207
3  0 1 2 -4027.552 -4011.592 -4027.536
4  0 1 3 -4026.393 -4005.113 -4026.366
5  0 1 4 -4027.981 -4001.382 -4027.941
6  1 1 0 -4029.258 -4018.618 -4029.250
7  1 1 1 -4027.303 -4011.343 -4027.287
8  1 1 2 -4025.635 -4004.355 -4025.608
9  1 1 3 -4025.688 -3999.089 -4025.648
10 1 1 4 -4026.002 -3994.083 -4025.946
11 2 1 0 -4027.454 -4011.494 -4027.438
12 2 1 1 -4025.262 -4003.983 -4025.236
13 2 1 2 -4034.277 -4007.678 -4034.237
14 2 1 3 -4026.394 -3994.475 -4026.338
15 2 1 4 -4024.224 -3986.985 -4024.149
16 3 1 0 -4026.635 -4005.355 -4026.608
17 3 1 1 -4026.035 -3999.436 -4025.995
18 3 1 2 -4024.603 -3992.684 -4024.547
19 3 1 3 -4022.766 -3985.527 -4022.691
20 3 1 4 -4022.240 -3979.681 -4022.144
21 4 1 0 -4028.141 -4001.541 -4028.101
22 4 1 1 -4026.153 -3994.233 -4026.097
23 4 1 2 -4024.293 -3987.054 -4024.219
24 4 1 3 -4022.402 -3979.843 -4022.306</code></pre>
</div>
</div>
<p>ARIMA(2,1,2)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(<span class="fu">log</span>(cvna))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: log(cvna) 
ARIMA(5,2,0) 

Coefficients:
          ar1      ar2      ar3      ar4      ar5
      -0.7921  -0.6080  -0.4742  -0.3629  -0.1890
s.e.   0.0253   0.0311   0.0327   0.0312   0.0254

sigma^2 = 0.004752:  log likelihood = 1896.75
AIC=-3781.5   AICc=-3781.44   BIC=-3749.58</code></pre>
</div>
</div>
<p>Using the <code>auto.arima</code> function, we can see the the best model is the ARIMA(5,2,0). But the ACF and PACF does not suggest these are good values. Since the auto arima function is sometimes un-trsutworthy, I am still going to go with the (2,1,2) ARIMA as determined by the manual arima model selection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model_output <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">Arima</span>(cvna, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">include.drift =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the standardized residuals plots, we can see that the ARIMA model is insufficient to accurately model the financial time series data. Thus, we will need to use the GARCH model on top of the residuals from the ARIMA model. This is a common tactic in financial time series which has a much different pattern than other time series like the greenhouse gases for the remainder of the project. Thus, we will continue modeling with the GARCH model. I choice the GARCH values based on the ACF graph, of the ARIMA mode. As we can see from this chart, we should try all p,q values between 0 and 4.</p>
</section>
</section>
<section id="garch-model" class="level2">
<h2 class="anchored" data-anchor-id="garch-model">GARCH model</h2>
<p>Next, we will fit the ARIMA model and then fit a GARCH model to the residuals of the ARIMA model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">=</span><span class="fu">log</span>(cvna)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>arima.fit<span class="ot">=</span><span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>arima.res<span class="ot">=</span>arima.fit<span class="sc">$</span>residuals</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(arima.res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(arima.res<span class="sc">^</span><span class="dv">2</span>) <span class="co"># clear correlation 1,2,4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(arima.res<span class="sc">^</span><span class="dv">2</span>) <span class="co"># clear correlation 1,4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    model[[cc]] <span class="ot">=</span> <span class="fu">garch</span>(arima.res,<span class="at">order=</span><span class="fu">c</span>(q,p),<span class="at">trace=</span>F)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">=</span> cc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="do">## get AIC values for model evaluation</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>GARCH_AIC <span class="ot">=</span> <span class="fu">sapply</span>(model, AIC) <span class="do">## model with lowest AIC is the best</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>model[[<span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = arima.res, order = c(q, p), trace = F)

Coefficient(s):
       a0         a1         b1         b2  
1.774e-05  8.952e-02  3.755e-01  5.358e-01  </code></pre>
</div>
</div>
<p>After trying all p,q values from 0,4 in combination, the GARCH(1,2) model is the best and has the lowest combination of AIC and BIC models. I tested all of the models, but only included the output from the best one. I attempted to use cross validation but was unsuccessful in making comparisons between the different models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">2</span>), arima.res,<span class="at">trace =</span> F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 2), data = arima.res, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 2)
&lt;environment: 0x000001971d76a758&gt;
 [data = arima.res]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1       beta2  
3.2701e-04  1.7583e-05  8.9457e-02  3.7710e-01  5.3440e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     3.270e-04   1.106e-03    0.296  0.76749    
omega  1.758e-05   8.715e-06    2.018  0.04363 *  
alpha1 8.946e-02   1.522e-02    5.876 4.19e-09 ***
beta1  3.771e-01   1.453e-01    2.595  0.00946 ** 
beta2  5.344e-01   1.372e-01    3.896 9.79e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 2310.996    normalized:  1.529448 

Description:
 Mon May  1 12:44:34 2023 by user: sleblanc 


Standardised Residuals Tests:
                                Statistic p-Value  
 Jarque-Bera Test   R    Chi^2  1408.668  0        
 Shapiro-Wilk Test  R    W      0.9548206 0        
 Ljung-Box Test     R    Q(10)  12.31858  0.2643006
 Ljung-Box Test     R    Q(15)  19.50652  0.1916912
 Ljung-Box Test     R    Q(20)  20.63407  0.4189453
 Ljung-Box Test     R^2  Q(10)  6.022325  0.8133841
 Ljung-Box Test     R^2  Q(15)  9.940587  0.8234604
 Ljung-Box Test     R^2  Q(20)  11.10935  0.9433373
 LM Arch Test       R    TR^2   8.351932  0.757059 

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-3.052277 -3.034671 -3.052299 -3.045721 </code></pre>
</div>
</div>
<p>Since all the models has similar AIC ,BIC values, I would go with GARCH(1,1) which all the coefficients are significant.</p>
<section id="final-model" class="level3">
<h3 class="anchored" data-anchor-id="final-model">Final Model</h3>
<p>The final model has a decent but not great fir for the Carvana stock return data. All of the errors except for mu are significant but the Ljung-Box statistics are well over the standard threshold. Since there is a mix of indicators, this tells us that the model is decent but not quantifiable better than the simpler ARIMA model. Thus, in this case I would rely on the ARIMA since it is a simpler specification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>arima.fit<span class="ot">=</span><span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: data 
ARIMA(2,1,2) with drift 

Coefficients:
         ar1      ar2      ma1    ma2    drift
      0.8796  -0.9659  -0.8770  0.987  -0.0003
s.e.  0.0116   0.0193   0.0078  0.014   0.0017

sigma^2 = 0.004033:  log likelihood = 2022.16
AIC=-4032.33   AICc=-4032.27   BIC=-4000.41

Training set error measures:
                       ME       RMSE        MAE         MPE     MAPE       MASE
Training set 3.270138e-05 0.06337709 0.04147109 -0.03123005 1.238118 0.02851845
                   ACF1
Training set 0.02665098</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>final.fit <span class="ot">=</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">2</span>), arima.res,<span class="at">trace =</span> F)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 2), data = arima.res, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 2)
&lt;environment: 0x000001971f6ebfb0&gt;
 [data = arima.res]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1       beta2  
3.2701e-04  1.7583e-05  8.9457e-02  3.7710e-01  5.3440e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     3.270e-04   1.106e-03    0.296  0.76749    
omega  1.758e-05   8.715e-06    2.018  0.04363 *  
alpha1 8.946e-02   1.522e-02    5.876 4.19e-09 ***
beta1  3.771e-01   1.453e-01    2.595  0.00946 ** 
beta2  5.344e-01   1.372e-01    3.896 9.79e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 2310.996    normalized:  1.529448 

Description:
 Mon May  1 12:44:35 2023 by user: sleblanc 


Standardised Residuals Tests:
                                Statistic p-Value  
 Jarque-Bera Test   R    Chi^2  1408.668  0        
 Shapiro-Wilk Test  R    W      0.9548206 0        
 Ljung-Box Test     R    Q(10)  12.31858  0.2643006
 Ljung-Box Test     R    Q(15)  19.50652  0.1916912
 Ljung-Box Test     R    Q(20)  20.63407  0.4189453
 Ljung-Box Test     R^2  Q(10)  6.022325  0.8133841
 Ljung-Box Test     R^2  Q(15)  9.940587  0.8234604
 Ljung-Box Test     R^2  Q(20)  11.10935  0.9433373
 LM Arch Test       R    TR^2   8.351932  0.757059 

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-3.052277 -3.034671 -3.052299 -3.045721 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">capture.output</span>(final.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] ""                                                               
 [2] "Title:"                                                         
 [3] " GARCH Modelling "                                              
 [4] ""                                                               
 [5] "Call:"                                                          
 [6] " garchFit(formula = ~garch(1, 2), data = arima.res, trace = F) "
 [7] ""                                                               
 [8] "Mean and Variance Equation:"                                    
 [9] " data ~ garch(1, 2)"                                            
[10] "&lt;environment: 0x000001971f6ebfb0&gt;"                              
[11] " [data = arima.res]"                                            
[12] ""                                                               
[13] "Conditional Distribution:"                                      
[14] " norm "                                                         
[15] ""                                                               
[16] "Coefficient(s):"                                                
[17] "        mu       omega      alpha1       beta1       beta2  "   
[18] "3.2701e-04  1.7583e-05  8.9457e-02  3.7710e-01  5.3440e-01  "   
[19] ""                                                               
[20] "Std. Errors:"                                                   
[21] " based on Hessian "                                             
[22] ""                                                               
[23] "Error Analysis:"                                                
[24] "        Estimate  Std. Error  t value Pr(&gt;|t|)    "             
[25] "mu     3.270e-04   1.106e-03    0.296  0.76749    "             
[26] "omega  1.758e-05   8.715e-06    2.018  0.04363 *  "             
[27] "alpha1 8.946e-02   1.522e-02    5.876 4.19e-09 ***"             
[28] "beta1  3.771e-01   1.453e-01    2.595  0.00946 ** "             
[29] "beta2  5.344e-01   1.372e-01    3.896 9.79e-05 ***"             
[30] "---"                                                            
[31] "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1" 
[32] ""                                                               
[33] "Log Likelihood:"                                                
[34] " 2310.996    normalized:  1.529448 "                            
[35] ""                                                               
[36] "Description:"                                                   
[37] " Mon May  1 12:44:35 2023 by user: sleblanc "                   
[38] ""                                                               </code></pre>
</div>
</div>
<p>Let <span class="math inline">\(x_t\)</span> be the time series data and <span class="math inline">\(z_t\)</span> be the residuals of the ARIMA model. Then the GARCH(1, 2) model is defined by:</p>
<p><span class="math display">\[z_t = \sigma_t * \epsilon_t\]</span></p>
<p>where <span class="math inline">\(\epsilon_t\)</span> follows a standard normal distribution (mean = 0, sd = 1), and the conditional variance <span class="math inline">\(\sigma_t^2\)</span> is given by:</p>
<p><span class="math display">\[\sigma_t^2 = \omega + \alpha_1 * z_(t-1)^2 + \beta_1 * \sigma_(t-1)^2 + \beta_2 * \sigma_(t-2)^2\]</span></p>
<p>with the estimated coefficients being:</p>
<p><span class="math inline">\(\omega\)</span> = 0.00001667 <span class="math inline">\(\alpha_1\)</span> = 0.08827887 <span class="math inline">\(\beta_1\)</span> = 0.37861131 <span class="math inline">\(\beta_2\)</span> = 0.53446470 The model is fitted to the residuals of an ARIMA model (arima.res).</p>
</section>
<section id="forecast" class="level3">
<h3 class="anchored" data-anchor-id="forecast">Forecast</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(final.fit, <span class="at">n.ahead =</span> <span class="dv">100</span>, <span class="at">plot=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    meanForecast  meanError standardDeviation lowerInterval upperInterval
1   0.0003270138 0.06720245        0.06720245    -0.1313874     0.1320414
2   0.0003270138 0.06778052        0.06778052    -0.1325204     0.1331744
3   0.0003270138 0.06763475        0.06763475    -0.1322347     0.1328887
4   0.0003270138 0.06787450        0.06787450    -0.1327046     0.1333586
5   0.0003270138 0.06790845        0.06790845    -0.1327711     0.1334251
6   0.0003270138 0.06805196        0.06805196    -0.1330524     0.1337064
7   0.0003270138 0.06813690        0.06813690    -0.1332188     0.1338729
8   0.0003270138 0.06825292        0.06825292    -0.1334462     0.1341003
9   0.0003270138 0.06835221        0.06835221    -0.1336409     0.1342949
10  0.0003270138 0.06846027        0.06846027    -0.1338527     0.1345067
11  0.0003270138 0.06856352        0.06856352    -0.1340550     0.1347090
12  0.0003270138 0.06866918        0.06866918    -0.1342621     0.1349161
13  0.0003270138 0.06877341        0.06877341    -0.1344664     0.1351204
14  0.0003270138 0.06887826        0.06887826    -0.1346719     0.1353259
15  0.0003270138 0.06898263        0.06898263    -0.1348765     0.1355305
16  0.0003270138 0.06908712        0.06908712    -0.1350813     0.1357353
17  0.0003270138 0.06919140        0.06919140    -0.1352856     0.1359397
18  0.0003270138 0.06929565        0.06929565    -0.1354900     0.1361440
19  0.0003270138 0.06939978        0.06939978    -0.1356940     0.1363481
20  0.0003270138 0.06950383        0.06950383    -0.1358980     0.1365520
21  0.0003270138 0.06960778        0.06960778    -0.1361017     0.1367558
22  0.0003270138 0.06971164        0.06971164    -0.1363053     0.1369593
23  0.0003270138 0.06981542        0.06981542    -0.1365087     0.1371627
24  0.0003270138 0.06991910        0.06991910    -0.1367119     0.1373659
25  0.0003270138 0.07002269        0.07002269    -0.1369149     0.1375690
26  0.0003270138 0.07012620        0.07012620    -0.1371178     0.1377718
27  0.0003270138 0.07022962        0.07022962    -0.1373205     0.1379745
28  0.0003270138 0.07033295        0.07033295    -0.1375230     0.1381771
29  0.0003270138 0.07043619        0.07043619    -0.1377254     0.1383794
30  0.0003270138 0.07053934        0.07053934    -0.1379276     0.1385816
31  0.0003270138 0.07064241        0.07064241    -0.1381296     0.1387836
32  0.0003270138 0.07074539        0.07074539    -0.1383314     0.1389854
33  0.0003270138 0.07084828        0.07084828    -0.1385331     0.1391871
34  0.0003270138 0.07095109        0.07095109    -0.1387346     0.1393886
35  0.0003270138 0.07105382        0.07105382    -0.1389359     0.1395899
36  0.0003270138 0.07115646        0.07115646    -0.1391371     0.1397911
37  0.0003270138 0.07125902        0.07125902    -0.1393381     0.1399921
38  0.0003270138 0.07136149        0.07136149    -0.1395389     0.1401930
39  0.0003270138 0.07146388        0.07146388    -0.1397396     0.1403936
40  0.0003270138 0.07156618        0.07156618    -0.1399401     0.1405942
41  0.0003270138 0.07166840        0.07166840    -0.1401405     0.1407945
42  0.0003270138 0.07177054        0.07177054    -0.1403407     0.1409947
43  0.0003270138 0.07187260        0.07187260    -0.1405407     0.1411947
44  0.0003270138 0.07197458        0.07197458    -0.1407406     0.1413946
45  0.0003270138 0.07207648        0.07207648    -0.1409403     0.1415943
46  0.0003270138 0.07217829        0.07217829    -0.1411398     0.1417939
47  0.0003270138 0.07228003        0.07228003    -0.1413392     0.1419933
48  0.0003270138 0.07238168        0.07238168    -0.1415385     0.1421925
49  0.0003270138 0.07248326        0.07248326    -0.1417376     0.1423916
50  0.0003270138 0.07258475        0.07258475    -0.1419365     0.1425905
51  0.0003270138 0.07268617        0.07268617    -0.1421353     0.1427893
52  0.0003270138 0.07278751        0.07278751    -0.1423339     0.1429879
53  0.0003270138 0.07288877        0.07288877    -0.1425324     0.1431864
54  0.0003270138 0.07298995        0.07298995    -0.1427307     0.1433847
55  0.0003270138 0.07309106        0.07309106    -0.1429288     0.1435829
56  0.0003270138 0.07319209        0.07319209    -0.1431268     0.1437809
57  0.0003270138 0.07329304        0.07329304    -0.1433247     0.1439787
58  0.0003270138 0.07339392        0.07339392    -0.1435224     0.1441764
59  0.0003270138 0.07349472        0.07349472    -0.1437200     0.1443740
60  0.0003270138 0.07359544        0.07359544    -0.1439174     0.1445714
61  0.0003270138 0.07369609        0.07369609    -0.1441147     0.1447687
62  0.0003270138 0.07379666        0.07379666    -0.1443118     0.1449658
63  0.0003270138 0.07389716        0.07389716    -0.1445088     0.1451628
64  0.0003270138 0.07399759        0.07399759    -0.1447056     0.1453596
65  0.0003270138 0.07409794        0.07409794    -0.1449023     0.1455563
66  0.0003270138 0.07419822        0.07419822    -0.1450988     0.1457528
67  0.0003270138 0.07429842        0.07429842    -0.1452952     0.1459492
68  0.0003270138 0.07439855        0.07439855    -0.1454915     0.1461455
69  0.0003270138 0.07449861        0.07449861    -0.1456876     0.1463416
70  0.0003270138 0.07459860        0.07459860    -0.1458836     0.1465376
71  0.0003270138 0.07469851        0.07469851    -0.1460794     0.1467334
72  0.0003270138 0.07479836        0.07479836    -0.1462751     0.1469291
73  0.0003270138 0.07489813        0.07489813    -0.1464706     0.1471247
74  0.0003270138 0.07499783        0.07499783    -0.1466660     0.1473201
75  0.0003270138 0.07509746        0.07509746    -0.1468613     0.1475153
76  0.0003270138 0.07519702        0.07519702    -0.1470564     0.1477105
77  0.0003270138 0.07529651        0.07529651    -0.1472514     0.1479055
78  0.0003270138 0.07539593        0.07539593    -0.1474463     0.1481003
79  0.0003270138 0.07549529        0.07549529    -0.1476410     0.1482951
80  0.0003270138 0.07559457        0.07559457    -0.1478356     0.1484896
81  0.0003270138 0.07569378        0.07569378    -0.1480301     0.1486841
82  0.0003270138 0.07579293        0.07579293    -0.1482244     0.1488784
83  0.0003270138 0.07589201        0.07589201    -0.1484186     0.1490726
84  0.0003270138 0.07599102        0.07599102    -0.1486126     0.1492667
85  0.0003270138 0.07608996        0.07608996    -0.1488066     0.1494606
86  0.0003270138 0.07618883        0.07618883    -0.1490004     0.1496544
87  0.0003270138 0.07628764        0.07628764    -0.1491940     0.1498480
88  0.0003270138 0.07638638        0.07638638    -0.1493875     0.1500416
89  0.0003270138 0.07648506        0.07648506    -0.1495809     0.1502350
90  0.0003270138 0.07658367        0.07658367    -0.1497742     0.1504282
91  0.0003270138 0.07668221        0.07668221    -0.1499674     0.1506214
92  0.0003270138 0.07678069        0.07678069    -0.1501604     0.1508144
93  0.0003270138 0.07687910        0.07687910    -0.1503533     0.1510073
94  0.0003270138 0.07697745        0.07697745    -0.1505460     0.1512000
95  0.0003270138 0.07707573        0.07707573    -0.1507386     0.1513927
96  0.0003270138 0.07717395        0.07717395    -0.1509312     0.1515852
97  0.0003270138 0.07727211        0.07727211    -0.1511235     0.1517776
98  0.0003270138 0.07737020        0.07737020    -0.1513158     0.1519698
99  0.0003270138 0.07746823        0.07746823    -0.1515079     0.1521619
100 0.0003270138 0.07756619        0.07756619    -0.1516999     0.1523540</code></pre>
</div>
</div>
</section>
</section>
<section id="volatality-plot" class="level2">
<h2 class="anchored" data-anchor-id="volatality-plot">Volatality plot</h2>
<p>Finally, we should also consider the volatility of the data. Volatility is a key feature of financial time series data and will have large effect on the model we end up choosing. Below is the plot of the volatility of the Carvana data. When looking at the volatility plot, we see several large spikes that stick out. The first is in March 2020, which was right at the beginning of COVID, so the volatility is expected. The second large spike occurs at the send of 2022, which is unexpected because the value of the stock is so low at that point. However, it could be thatwith such a low stock price, relative changes have a greater effect. A $10 gain when the stock is at $10 is a 100% increase, but when the stock was at $400 this would be just a 2.5% gain. So it is not crazy that the stock because much more volatile as they value fell off a cliff in 2022.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ht <span class="ot">=</span> final.fit<span class="sc">@</span>h.t <span class="co">#a numeric vector with the conditional variances (h.t = sigma.t^delta)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>CVNA<span class="ot">=</span><span class="fu">data.frame</span>(CVNA)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>CVNA <span class="ot">=</span> <span class="fu">data.frame</span>(CVNA,<span class="fu">rownames</span>(CVNA))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CVNA)[<span class="dv">7</span>] <span class="ot">=</span> <span class="st">"date"</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>CVNA<span class="sc">$</span>date<span class="ot">=</span><span class="fu">as.Date</span>(CVNA<span class="sc">$</span>date,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(CVNA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1511 obs. of  7 variables:
 $ CVNA.Open    : num  13.5 11.6 10.95 10.18 8.59 ...
 $ CVNA.High    : num  13.9 11.7 10.9 10.2 10 ...
 $ CVNA.Low     : num  10.7 10.7 10 8.18 8.14 9.75 10.5 10.4 9.61 10.4 ...
 $ CVNA.Close   : num  11.1 10.77 10.1 8.72 9.98 ...
 $ CVNA.Volume  : num  11297800 1291300 991500 3356500 1840200 ...
 $ CVNA.Adjusted: num  11.1 10.77 10.1 8.72 9.98 ...
 $ date         : Date, format: "2017-04-28" "2017-05-01" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">=</span> <span class="fu">data.frame</span>(ht,CVNA<span class="sc">$</span>date)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">y =</span> ht, <span class="at">x =</span> CVNA.date)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">'#009933'</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">'Conditional Variance'</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">'Date'</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Volatality plot of Carvana Stock"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ftsm_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./arimax.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">ARIMAX/SARIMAX/VAR</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./greenhouse_gases_deep_learning.html" class="pagination-link">
        <span class="nav-page-text">Deep Learning for TS</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>